<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Dashboard - AyurHeal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family:'Poppins', sans-serif; margin:0; background: #eaf7f0; }
        h1 { text-align:center; color:#0c6d4e; margin:20px 0; }
        .current-slot { background: linear-gradient(135deg, #ff9800, #ff5722); color: white !important; font-weight: bold; border-radius: 8px; animation: pulse 1.5s infinite; box-shadow: 0 0 10px rgba(255, 87, 34, 0.8); cursor: pointer; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        #clockBar { background: linear-gradient(90deg, #0c6d4e, #34a853); color: white; padding: 15px; text-align: center; display: flex; justify-content: space-between; align-items: center; box-shadow: 0px 3px 6px rgba(0,0,0,0.2); position: sticky; top: 0; z-index: 1000; }
        #liveClock { font-size: 20px; font-weight: bold; }
        .tabs { display:flex; justify-content:center; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
        .tab-btn { background:#fff; padding:10px 20px; border-radius:12px; cursor:pointer; box-shadow:0 5px 15px rgba(0,0,0,0.1); transition:0.3s; }
        .tab-btn.active { background:#0c6d4e; color:#fff; }
        .tab-btn:hover { transform:scale(1.05); }
        .section { display:none; max-width:1100px; margin:0 auto 20px; background:#ffffffcc; padding:20px; border-radius:18px; backdrop-filter:blur(6px); box-shadow:0 12px 30px rgba(0,0,0,0.15); animation:fadeIn 0.8s ease; }
        .schedule-container { display:flex; gap:10px; overflow-x:auto; }
        .day-column { background:#fff; border-radius:12px; padding:10px; min-width:140px; flex:1; display:flex; flex-direction:column; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
        .day-column h3 { text-align:center; margin-bottom:10px; color:#0c6d4e; }
        .slot { background:#d6f0e2; margin:4px 0; padding:10px; border-radius:6px; text-align:center; cursor:pointer; transition:0.3s; }
        .slot.booked { background:#13a36f; color:#fff; }
        .slot.pending { background:#f3a712; color:#fff; }
        .slot.completed { background:#0c6d4e; color:#fff; }
        .slot.canceled { background:#e14d4d; color:#fff; }
        .slot:hover { transform:scale(1.05); box-shadow:0 3px 8px rgba(0,0,0,0.2); }
        .notification { background:#d6f0e2; padding:12px; margin:6px 0; border-radius:8px; box-shadow:0 3px 10px rgba(0,0,0,0.1); transition:0.2s; }
        .notification:hover { transform:scale(1.02); box-shadow:0 6px 15px rgba(0,0,0,0.2); }
        @keyframes fadeIn{from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    </style>
</head>
<body>

<h1>Doctor Dashboard - AyurHeal</h1>

<div id="doctorInfo" style="text-align:center; margin-bottom:10px;">Loading doctor info...</div>

<div class="tabs">
    <div class="tab-btn active" onclick="showSection('home')">Home</div>
    <div class="tab-btn" onclick="showSection('schedule')">Schedule</div>
    <div class="tab-btn" onclick="showSection('notifications')">Notifications</div>
</div>

<div id="clockBar">
    <h2>ðŸ•’ Doctor Dashboard</h2>
    <div id="liveClock"></div>
</div>

<!-- Home Summary -->
<div class="section" id="home" style="display:block;">
    <div class="summary-card">
        <div class="summary-item">Today Appointments: <span id="todayCount">0</span></div>
        <div class="summary-item">Upcoming: <span id="upcomingCount">0</span></div>
        <div class="summary-item">Pending Notes: <span id="pendingCount">0</span></div>
        <div class="summary-item">Completed Patients: <span id="completedCount">0</span></div>
    </div>
</div>

<!-- Schedule -->
<div class="section" id="schedule">
    <div class="schedule-container" id="scheduleContainer">Loading slots...</div>
</div>

<!-- Notifications -->
<div class="section" id="notifications">
    <div class="notification">Hospital policy update: All patients must wear masks.</div>
    <div class="notification">New herbal medicine workshop: Friday at 10 AM.</div>
    <div class="notification">System maintenance: Saturday 9 PM - 11 PM.</div>
    <div class="notification">Patient feedback submitted: 3 new entries.</div>
</div>

<script>
    // Tabs
    function showSection(id){
        document.querySelectorAll('.section').forEach(s=>s.style.display='none');
        document.getElementById(id).style.display='block';
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.querySelector(`.tab-btn[onclick="showSection('${id}')"]`).classList.add('active');
    }

    // Live clock
    function updateClock() {
        const now = new Date();
        const options = { weekday:'long', year:'numeric', month:'long', day:'numeric'};
        document.getElementById("liveClock").textContent = `${now.toLocaleDateString('en-US', options)} | ${now.toLocaleTimeString('en-US')}`;
    }
    setInterval(updateClock,1000);
    updateClock();

    // Fetch doctor info & slots
    const doctorId = 1; // change if needed

    async function loadDoctor() {
        const infoDiv = document.getElementById("doctorInfo");
        const scheduleContainer = document.getElementById("scheduleContainer");

        try {
            const res = await fetch(`http://localhost:8080/doctors/${doctorId}`);
            if (!res.ok) throw new Error("Failed to fetch doctor info");
            const doctor = await res.json();

            // Display doctor info
            infoDiv.innerHTML = `<h2>${doctor.name} (${doctor.specialization}) | Fee: LKR ${doctor.fee} | Contact: ${doctor.contact}</h2>`;

            // Show schedule
            scheduleContainer.innerHTML = "";
            if (!doctor.availability || doctor.availability.length === 0) {
                scheduleContainer.innerHTML = "<p>No slots available</p>";
                return;
            }

            const now = new Date();
            const slotsByDate = {};

            doctor.availability.forEach(slot => {
                if (!slotsByDate[slot.date]) slotsByDate[slot.date] = [];
                slotsByDate[slot.date].push(slot);
            });

            Object.keys(slotsByDate).forEach(date => {
                const dayColumn = document.createElement("div");
                dayColumn.className = "day-column";

                const title = document.createElement("h3");
                title.textContent = date;
                dayColumn.appendChild(title);

                slotsByDate[date].forEach(slot => {
                    const slotDiv = document.createElement("div");
                    slotDiv.className = "slot pending";
                    slotDiv.textContent = `${slot.startTime} - ${slot.endTime}`;

                    // Highlight current slot
                    const slotDate = new Date(slot.date);
                    const slotHour = parseInt(slot.startTime.split(":")[0]);
                    if (slotDate.toDateString() === now.toDateString() && slotHour === now.getHours()) {
                        slotDiv.classList.add("current-slot");
                    }

                    slotDiv.addEventListener("click", () => {
                        alert(`Slot: ${slot.startTime} - ${slot.endTime}\nLength: ${slot.slotLength} min`);
                    });

                    dayColumn.appendChild(slotDiv);
                });

                scheduleContainer.appendChild(dayColumn);
            });

        } catch (err) {
            console.error(err);
            infoDiv.innerHTML = "<p style='color:red;'>Failed to load doctor info</p>";
            scheduleContainer.innerHTML = "<p style='color:red;'>Failed to load slots</p>";
        }
    }

    loadDoctor();
</script>
</body>
</html>
//http://localhost:5500/myweb.html
//python -m http.server 5500